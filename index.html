<!DOCTYPE hyml>

<html>

<head>
	<title>Biking Helper</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Add material.io API -->
	<link href="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.css" rel="stylesheet">
	<script src="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<!-- Add icon library -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- My CSS -->
	<link rel="stylesheet" href="style.css">
	
</head>

<body>

	<!-- Top NavBar -->
	<header class="mdc-top-app-bar app-bar" id="app-bar">
		<div class="mdc-top-app-bar__row">
			<section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
				<button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
				<span class="mdc-top-app-bar__title">Biking Helper</span>
			</section>
		</div>
	</header>
	<!-- Top NavBar End -->

	<!-- Left Drawer Start -->
	<aside class="mdc-drawer mdc-drawer--dismissible mdc-top-app-bar--fixed-adjust">
		<div class="mdc-drawer__content">
			<div class="mdc-list">
				<a class="mdc-list-item mdc-list-item--activated" href="#Home" data-toScreen="Home" aria-current="page">
					<span class="mdc-list-item__ripple"></span>
					<i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>
					<span class="mdc-list-item__text">Home</span>
				</a>
				<a class="mdc-list-item" href="#News" data-toScreen="News">
					<span class="mdc-list-item__ripple"></span>
					<i class="material-icons mdc-list-item__graphic" aria-hidden="true">article</i>
					<span class="mdc-list-item__text">News</span>
				</a>
				<a class="mdc-list-item" href="#Filters" data-toScreen="Filters">
					<span class="mdc-list-item__ripple"></span>
					<i class="material-icons mdc-list-item__graphic" aria-hidden="true">smart_button</i>
					<span class="mdc-list-item__text">Filters</span>
				</a>
				<a class="mdc-list-item" href="#List" data-toScreen="List">
					<span class="mdc-list-item__ripple"></span>
					<i class="material-icons mdc-list-item__graphic" aria-hidden="true">list</i>
					<span class="mdc-list-item__text">List</span>
				</a>
				<a class="mdc-list-item" id="ListMap" href="#Map" data-toScreen="Map">
					<span class="mdc-list-item__ripple"></span>
					<i class="material-icons mdc-list-item__graphic" aria-hidden="true">map</i>
					<span class="mdc-list-item__text">Map</span>
				</a>
			</div>
		</div>
	</aside>
	<!-- Left Drawer End -->

	<!-- Main Content Start -->
	<div class="mdc-drawer-app-content mdc-top-app-bar--fixed-adjust">
		<main class="main-content" id="main-content">
			<!-- Home Page Start-->
			<div class="mdc-top-app-bar--fixed-adjust myPage" id="Home">

				<h1>Welcome to Biking Helper</h1>
				<h2>This site will help you find recent biking incidents and bike racks in the Chicagoland area. Click on the top left menu to start exploring.</h2>
			</div>
			<!-- Home Page Start-->

			<!-- News Page Start-->
			<div class="mdc-top-app-bar--fixed-adjust myPage" id="News" style="display: none;">

				<h1>Recent biking incidents around Chicago</h1>
				<div class="mdc-card">  <!-- Card Start -->
					<div class="mdc-card__text-wrapper">
						<div class="mdc-card__title">Card Title</div>
						<div class="mdc-card__subtitle">Card Subtitle</div>
						<div class="mdc-card__address">Address</div>
					</div>
					<div class="mdc-card__text-wrapper">
						<div class="mdc-card__description">This is describing the incident</div>
					</div>
				</div> <!-- Card End -->
			</div>
				<!-- News Page End -->

				<!-- Map Page Start-->
				<div class="mdc-top-app-bar--fixed-adjust myPage" id="Map" style="display: none;">

					<h1>This is the Map Screen</h1>
					<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAtemI2wGOdaB-bZLurssCbWR3J1335ULY&callback=initMap&libraries=&v=weekly" async></script>
				</div>
				<!-- Map Page End-->

				<div class="mdc-top-app-bar--fixed-adjust myPage" id="Filters" style="display: none;">
					<h3>Here you can filter what data you want to see using the filters bellow</h3>


					<label class="mdc-text-field mdc-text-field--filled">
						<span class="mdc-text-field__ripple"></span>
						<span class="mdc-floating-label" id="my-label-id">Enter a zipcode</span>
						<input class="mdc-text-field__input" type="text" aria-labelledby="my-label-id">
						<span class="mdc-line-ripple"></span>
					</label>

					<label class="mdc-text-field mdc-text-field--filled">
						<span class="mdc-text-field__ripple"></span>
						<span class="mdc-floating-label" id="my-label-id">Proximity in miles</span>
						<input class="mdc-text-field__input" type="text" aria-labelledby="my-label-id">
						<span class="mdc-line-ripple"></span>
					</label>

					<br>
					<h3>Incident type:</h3>
					<!-- CheckBox 1 -->
					<div class="mdc-form-field">
						<div class="mdc-checkbox">
							<input type="checkbox" class="mdc-checkbox__native-control" id="checkbox-1"/>
							<div class="mdc-checkbox__background">
								<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
									<path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
								</svg>
								<div class="mdc-checkbox__mixedmark"></div>
							</div>
							<div class="mdc-checkbox__ripple"></div>
						</div>
						<label for="checkbox-1">Crash</label>
					</div>
					<!-- CheckBox 1 -->
					<!-- CheckBox 2 -->
					<div class="mdc-form-field">
						<div class="mdc-checkbox">
							<input type="checkbox" class="mdc-checkbox__native-control" id="checkbox-1"/>
							<div class="mdc-checkbox__background">
								<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
									<path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
								</svg>
								<div class="mdc-checkbox__mixedmark"></div>
							</div>
							<div class="mdc-checkbox__ripple"></div>
						</div>
						<label for="checkbox-1">Hazard</label>
					</div>
					<!-- CheckBox 2 -->
					<!-- CheckBox 3 -->
					<div class="mdc-form-field">
						<div class="mdc-checkbox">
							<input type="checkbox" class="mdc-checkbox__native-control" id="checkbox-1"/>
							<div class="mdc-checkbox__background">
								<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
									<path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
								</svg>
								<div class="mdc-checkbox__mixedmark"></div>
							</div>
							<div class="mdc-checkbox__ripple"></div>
						</div>
						<label for="checkbox-1">Theft</label>
					</div>
					<!-- CheckBox 3 -->
					<!-- CheckBox 3 -->
					<div class="mdc-form-field">
						<div class="mdc-checkbox">
							<input type="checkbox" class="mdc-checkbox__native-control" id="checkbox-1"/>
							<div class="mdc-checkbox__background">
								<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
									<path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
								</svg>
								<div class="mdc-checkbox__mixedmark"></div>
							</div>
							<div class="mdc-checkbox__ripple"></div>
						</div>
						<label for="checkbox-1">Unconfirmed</label>
					</div>
					<!-- CheckBox 3 -->
					<br>
					<button class="mdc-button mdc-button--raised foo-button">
						<span class="mdc-button__label">Show SnackBar</span>
					</button>

					<div class="mdc-snackbar">
						<div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
							<div class="mdc-snackbar__label center" aria-atomic="false">
								Nothing was entered
							</div>
						</div>
					</div>
					<!-- Input Page End -->

				</div>
			</main>
		</div>
		<!-- Main Content End -->
	</body>

	</html>

	<!-- My Script -->
	<script src="app.js"></script>
	<script type="text/javascript">

		// initailize Google Map
		var myMap;
		var mapMarkerNews;

		// populate news cards
		let file="https://bikewise.org:443/api/v2/incidents?page=1&proximity=Chicago%2C%20IL&proximity_square=30"
      fetch (file)
      .then(x => { 
              return x.json()
            })
      .then(json => {
              let i = 0;
              let originalCard = document.querySelector(".mdc-card");
              for(i = 0; i < json.incidents.length; i++){
                let copy = originalCard.cloneNode(true);
                copy.querySelector(".mdc-card__title").innerHTML = json.incidents[i].title;
                let unix = json.incidents[i].occurred_at;
                var date = new Date(unix*1000);
                var minute = date.getMinutes();
                if(minute < 10){
                	minute = "0"+minute;
                }
                var formatedDate = date.getMonth()+1 + "/" + date.getDate() + "/" + date.getFullYear() + "     " + date.getHours() + ":" + minute;
                copy.querySelector(".mdc-card__subtitle").innerHTML = formatedDate;
                copy.querySelector(".mdc-card__address").innerHTML = json.incidents[i].address;
                copy.querySelector(".mdc-card__description").innerHTML = json.incidents[i].description;
                document.querySelector("#News").appendChild(copy);
                console.log("added: " + copy);

                // When address is clicked, bring up map with that address
                copy.querySelector(".mdc-card__address").addEventListener("click", evt => {
                	// send address to google geocode api and 
                	// get lat and longitude back
                	var link = "https://maps.googleapis.com/maps/api/geocode/json?address="
                	var key = "&key=AIzaSyAa4uCys20g6sytzES1nTnp-dojJ6H1avg"
                	var address = evt.target.innerHTML;
                	link = link + address + key;
                	fetch(link)
                	.then(z => {
                					return z.json()
                				})
                	.then(zjson => {
                					if(zjson.status === "OK"){
                						// remove old marker if there
                						if(mapMarkerNews != null){
                							mapMarkerNews.setMap(null);
                						}
                						// set new cords
                						var latitude = zjson.results[0].geometry.location.lat;
                						var longitude = zjson.results[0].geometry.location.lng;
                						var cords = { lat: latitude, lng: longitude};
    												myMap.setCenter(cords);

    												// place marker at cords
    												var marker = new google.maps.Marker({
    													position: cords,
													    map: myMap,
													    title: "address",
													  });
    												mapMarkerNews = marker;
    												// bring up map
    												document.querySelector("#ListMap").click();
                					}
                					console.log(zjson);
                				});
                });
              }
              originalCard.remove();
              
            });

      function initMap(){
	    const Chicago = { lat: 41.878 , lng: -87.629 };
	    // The map, centered at Chicago
	    myMap = new google.maps.Map(document.getElementById("Map"), {
	      zoom: 12,
	      center: Chicago,
	    });
		}

  
	</script>
